class Observer{constructor(e,t={}){this.targetSelector=e,this.isAsync=t.async||!1,this.trackReferences=t.trackReferences||!1,this.debounceTime=t.debounce||0,this.observer=null,this.listeners=[],this.debounceTimers={},this.initialize()}initialize(){this.observer=new MutationObserver((()=>this.checkAllListeners()));this.observer.observe(document.body,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["class","id"]}),this.checkAllListeners()}checkAllListeners(){const e="checkAll";if(this.debounceTimers[e]&&clearTimeout(this.debounceTimers[e]),this.debounceTime>0)this.debounceTimers[e]=setTimeout((()=>{for(const e of this.listeners)this.checkListener(e);delete this.debounceTimers[e]}),this.debounceTime);else for(const e of this.listeners)this.checkListener(e)}checkListener(e){const{selector:t,callbacks:s}=e,i=document.querySelectorAll(t),n=i.length>0,r=e.exists!==n;if(!r&&null!==e.exists&&!e.forceCallback)return;this.trackReferences&&n&&(e.elementReferences=Array.from(i));const c=e.elementReferences||[];e.exists=n,e.forceCallback=!1,n&&s.onFound?(r||e.pendingFound)&&(e.pendingFound=!1,this.executeCallback(s.onFound,[i])):!n&&s.onRemoved&&r&&this.executeCallback(s.onRemoved,[c]),r&&s.onChanged&&this.executeCallback(s.onChanged,[n?i:c,n]),n||this.trackReferences||(e.elementReferences=null)}executeCallback(e,t){"function"==typeof e&&(this.isAsync?setTimeout((()=>e(...t)),0):e(...t))}addListener(e,t){const s="function"==typeof t?{onFound:t}:t||{},i=this.listeners.find((t=>t.selector===e));if(i)return i.callbacks=s,i.forceCallback=!0,this.checkListener(i),this;const n={selector:e,callbacks:s,exists:null,elementReferences:null,pendingFound:!0,forceCallback:!1};return this.listeners.push(n),this.checkListener(n),this}listenToClass(e,t){const s=e.startsWith(".")?e:`.${e}`;let i;if(this.targetSelector.includes(" ")){const e=this.targetSelector.split(" ");e[e.length-1]+=s,i=e.join(" ")}else i=(this.targetSelector.includes("."),this.targetSelector+s);return this.addListener(i,t)}listenToId(e,t){const s=e.startsWith("#")?e:`#${e}`;let i;if(this.targetSelector.includes(" ")){const e=this.targetSelector.split(" ");e[e.length-1]+=s,i=e.join(" ")}else i=this.targetSelector.includes("#")?this.targetSelector.replace(/#[^.\s]+/,"")+s:this.targetSelector+s;return this.addListener(i,t)}listenToElement(e,t,s){let i;return("function"==typeof t||t&&"object"==typeof t&&!Array.isArray(t))&&(s=t,t=null),i=t?`${t} ${e}`:e,this.addListener(i,s)}disconnect(){this.observer&&(this.observer.disconnect(),this.observer=null),this.listeners=[]}}